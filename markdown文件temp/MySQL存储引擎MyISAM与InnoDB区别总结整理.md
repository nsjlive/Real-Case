## MySQL存储引擎

参考：[Mysql数据库3种存储引擎有什么区别？](http://www.imooc.com/wenda/detail/451741)

### MySQL存储引擎MyISAM与InnoDB区别总结整理

##### 1、MySQL默认存储引擎的变迁

在MySQL 5.1之前的版本中，默认的搜索引擎是MyISAM，从MySQL 5.5之后的版本中，**默认**的搜索引擎变更为InnoDB。

**2、MyISAM与InnoDB存储引擎的主要特点**

MyISAM存储引擎的特点是：表级锁、不支持事务和全文索引，适合一些CMS(**Content Management System**)内容管理系统作为后台数据库使用，但是使用**大并发、重负荷**生产系统上，表锁结构的特性就显得力不从心；

以下是MySQL 5.7 MyISAM存储引擎的版本特性：

![img](C:\Users\n\Desktop\markdown文件temp\MySQL存储引擎MyISAM与InnoDB区别总结整理)

InnoDB存储引擎的特点是：行级锁、事务安全（ACID兼容）、支持外键、不支持FULLTEXT类型的索引(5.6.4以后版本开始支持FULLTEXT类型的索引)。InnoDB存储引擎提供了具有提交、回滚和崩溃恢复能力的事务安全存储引擎。InnoDB是为处理巨大量时拥有最大性能而设计的。它的CPU效率可能是任何其他基于磁盘的关系数据库引擎所不能匹敌的。

以下是MySQL 5.7 InnoDB存储引擎的版本特性：

![img](C:\Users\n\Desktop\markdown文件temp\1620)

*注意：* 
InnoDB表的行锁也不是绝对的，假如在执行一个SQL语句时MySQL不能确定要扫描的范围，InnoDB表同样会锁全表，例如：`update table set num=1 where name like “a%”`。

两种类型最主要的差别就是InnoDB**支持事务处理与外键和行级锁**。而MyISAM不支持。所以MyISAM往往就容易被人认为只适合在小项目中使用。

**3、MyISAM与InnoDB性能测试**

下边两张图是官方提供的MyISAM与InnoDB的压力测试结果

![img](C:\Users\n\Desktop\markdown文件temp\1621)



![img](C:\Users\n\Desktop\markdown文件temp\1622)

可以看出，随着CPU核数的增加，InnoDB的吞吐量反而越好，而MyISAM，其吞吐量几乎没有什么变化，显然，**MyISAM的表锁定机制降低了读和写的吞吐量**。

**4、事务支持与否**

MyISAM是一种**非事务性的引擎**，使得MyISAM引擎的MySQL可以提供高速存储和检索，以及全文搜索能力，适合数据仓库等查询频繁的应用；

InnoDB是**事务安全**的；

事务是一种高级的处理方式，如在一些列增删改中只要哪个出错还可以**回滚还原**，而MyISAM就不可以了。

**5、MyISAM与InnoDB构成上的区别**

（1）每个MyISAM在磁盘上存储成三个文件：

> 第一个文件的名字以表的名字开始，扩展名指出文件类型，.frm[文件存储](https://cloud.tencent.com/product/cfs?from=10680)表定义。  第二个文件是**数据文件**，其扩展名为.MYD (MYData)。  第三个文件是**索引文件**，其扩展名是.MYI (MYIndex)。

（2）基于磁盘的资源是InnoDB表空间数据文件和它的日志文件，InnoDB 表的 大小**只受限于操作系统文件**的大小，一般为 2GB。

**6、MyISAM与InnoDB表锁和行锁的解释**

MySQL表级锁有两种模式：表共享读锁（Table Read Lock）和表独占写锁（Table Write Lock）。什么意思呢，就是说对MyISAM表进行读操作时，它不会阻塞其他用户对同一表的**读请求**，但会阻塞对同一表的**写操作**；而对MyISAM表的写操作，则会阻塞其他用户对同一表的读和写操作。

InnoDB行锁是通过给索引项加锁来实现的，即只有通过索引条件检索数据，InnoDB才使用行级锁，否则将使用表锁！行级锁在每次获取锁和释放锁的操作需要消耗比表锁更多的资源。在InnoDB两个事务发生死锁的时候，会计算出每个事务影响的行数，然后回滚行数少的那个事务。当锁定的场景中不涉及Innodb的时候，InnoDB是检测不到的。只能依靠锁定超时来解决。

**7、是否保存数据库表中表的具体行数**

InnoDB 中**不保存表的具体行数**，也就是说，执行`select count(*) from table` 时，InnoDB要扫描一遍整个表来计算有多少行，但是MyISAM只要简单的读出保存好的行数即可。

注意的是，当`count(*)`语句包含`where`条件时，两种表的操作是一样的。也就是 上述“6”中介绍到的InnoDB使用表锁的一种情况。

**8、如何选择**

MyISAM适合：  

（1）做很多**count** 的计算； 

（2）插入不频繁，**查询非常频繁**，如果执行大量的SELECT，MyISAM是更好的选择；

（3）没有事务。

InnoDB适合： 
（1）可靠性要求比较高，或者要求事务； 
（2）表更新和查询都相当的频繁，并且表锁定的机会比较大的情况指定数据引擎的创建； 
（3）如果你的数据执行大量的INSERT或UPDATE，出于性能方面的考虑，应该使用InnoDB表； 
（4）**DELETE FROM table**时，InnoDB不会重新建立表，而是一行一行的 删除； 
（5）LOAD TABLE FROM MASTER操作对InnoDB是不起作用的，解决方法是首先把InnoDB表改成MyISAM表，导入数据后再改成InnoDB表，但是对于使用的额外的InnoDB特性（例如外键）的表不适用。

要注意，创建每个表格的代码是相同的，除了最后的 TYPE参数，这一参数用来指定数据引擎。

**其他区别：**

1、对于AUTO_INCREMENT类型的字段，InnoDB中必须包含只有该字段的索引，但是在MyISAM表中，可以和其他字段一起建立联合索引。

2、DELETE FROM table时，InnoDB不会重新建立表，而是一行一行的删除。

3、**LOAD TABLE FROMMASTER操作对InnoDB是不起作用的**，解决方法是首**先把InnoDB表改成MyISAM表**，**导入数据后再改成InnoDB表**，但是对于使用的额外的InnoDB特性(例如外键)的表不适用。

4、 InnoDB存储引擎被完全与MySQL服务器整合，InnoDB存储引擎为在主内存中缓存数据和索引而维持它自己的缓冲池。

5、对于自增长的字段，InnoDB中必须包含只有该字段的索引，但是在MyISAM表中可以和其他字段一起建立联合索引。

6、清空整个表时，**InnoDB是一行一行的删除，效率非常慢**。MyISAM则会重建表。

------

##### MySQL中常用存储引擎有哪些？它们相互之间有什么区别？

MySQL中常用的四种存储引擎分别是： MyISAM存储引擎、innoDB存储引擎、MEMORY存储引擎、ARCHIVE存储引擎。本文将对这四种存储引擎作出重点介绍，最后对这四种存储引擎进行比较。

**MySQL中的存储引擎**

**一、存储引擎**

1、存储引擎其实就是对于数据库文件的一种**存取机制**，**如何实现存储数据**，**如何为存储的数据建立索引**以及**如何更新，查询数据**等技术实现的方法。

2、MySQL中的数据用**各种不同的技术存储在文件**（或内存）中，这些技术中的每一种技术都使用不同的存储机制，索引技巧，锁定水平并且最终提供广泛的不同功能和能力。在MySQL中将这些不同的技术及配套的相关功能称为存储引擎。

**二、MySQL** **中查看引擎**

1、show engines; // 查看mysql所支持的存储引擎，以及从中得到mysql默认的存储引擎。

![img](C:\Users\n\Desktop\markdown文件temp\v2-09bc7b5f6bc4f444ed6de03d8edabd54_hd.jpg)

2、show variables like '% storage_engine'; // 查看mysql 默认的存储引擎

3、show create table tablename ; // 查看具体某一个表所使用的存储引擎，这个默认存储引擎被修改了！

4、show table status from database where name="tablename" //准确查看某个数据库中的某一表所使用的存储引擎

**三、MySQL中常用的几种存储引擎：**

**MyISAM存储引擎：**

存放的位置： MySQL如果使用MyISAM存储引擎，数据库文件类型就包括.frm、.MYD、.MYI，默认存放位置是C:\Documentsand Settings\All Users\Application Data\MySQL\MySQL Server 5.1\data

存放的方式： **MyISAM 这种存储引擎不支持事务，不支持行级锁**，**只支持并发插入的表锁，主要用于高负载的select**。

索引的方式： MyISAM也是使用B+tree索引但是和Innodb的在具体实现上有些不同。

该引擎基于ISAM数据库引擎，除了提供ISAM里所没有的索引和字段管理等大量功能，MyISAM还使用一种表格锁定的机制来优化多个并发的读写操作，但是需要经常运行OPTIMIZE TABLE命令，来恢复被更新机制所浪费的空间，否则碎片也会随之增加，最终影响数据访问性能。MyISAM还有一些有用的扩展，例如用来修复数据库文件的MyISAMChk工具和用来恢复浪费空间的 MyISAMPack工具。MyISAM强调了快速读取操作，主要用于高负载的select，这可能也是MySQL深受Web开发的主要原因：在Web开发中进行的大量数据操作都是读取操作，所以大多数虚拟主机提供商和Internet平台提供商（Internet Presence Provider，IPP）只允许使用MyISAM格式。
MyISAM类型的表支持三种不同的存储结构：静态型、动态型、压缩型。
静态型：指定义的表列的大小是固定（即不含有：xblob、xtext、varchar等长度可变的数据类型），这样MySQL就会自动使用静态MyISAM格式。使用静态格式的表的性能比较高，因为在维护和访问以预定格式存储数据时需要的开销很低；但这种高性能是以空间为代价换来的，因为在定义的时候是固定的，所以不管列中的值有多大，都会以最大值为准，占据了整个空间。
动态型：如果列（即使只有一列）定义为动态的（xblob, xtext, varchar等数据类型），这时MyISAM就自动使用动态型，虽然动态型的表占用了比静态型表较少的空间，但带来了性能的降低，因为如果某个字段的内容发生改变则其位置很可能需要移动，这样就会导致碎片的产生，随着数据变化的增多，碎片也随之增加，数据访问性能会随之降低。
对于因碎片增加而降低数据访问性这个问题，有两种解决办法：
a、**尽可能使用静态数据类型**；
b、经常使用optimize table table_name语句整理表的碎片，恢复由于表数据的更新和删除导致的空间丢失。如果存储引擎不支持 optimize table table_name则可以转储并 重新加载数据，这样也可以减少碎片；
压缩型：如果在数据库中创建在整个生命周期内只读的表，则应该使用MyISAM的压缩型表来减少空间的占用。

优缺点：MyISAM的优势在于**占用空间小，处理速度快**。缺点是**不支持事务的完整性和并发性**。

**2．innoDB存储引擎**

存储位置：MySQL如果使用InnoDB存储引擎，数据库文件类型就包括.frm、ibdata1、.ibd，存放位置有两个，.frm文件默认存放位置是C:\Documents and Settings\All Users\ApplicationData\MySQL\MySQL Server 5.1\data，ibdata1、.ibd文件默认存放位置是MySQL安装目录下的data文件夹。

innodb存储引擎的mysql表提供了**事务，回滚**以及**系统崩溃修复**能力和多版本并发控制的事务的安全。

innodb支持自增长列（auto_increment）,自增长列的值不能为空，如果在使用的时候为空的话怎会进行自动存现有的值开始增值，如果有但是比现在的还大，则就保存这个值。

innodb存储引擎支持外键（foreign key） ,外键所在的表称为子表而所依赖的表称为父表。

innodb存储引擎最重要的是支持事务，以及事务相关联功能。

innodb存储引擎支持mvcc的行级锁。

innodb存储引擎索引使用的是B+Tree

优缺点：InnoDB的优势在于提供了良好的事务处理、崩溃修复能力和并发控制。缺点是**读写效率较差**，**占用的数据空间相对较大**。

**3．MEMORY存储引擎**

memory存储引擎相比前面的一些存储引擎，有点不一样，其使用存储在内从中的数据来创建表，而且所有的数据也都存储在内存中。

每个基于memory存储引擎的表实际对应一个磁盘文件，该文件的文件名和表名是相同的，类型为.frm。该文件只存储表的结构，而其**数据文件，都是存储在内存中**，这样有利于对数据的快速处理，提高整个表的处理能力。

memory存储引擎默认使用**哈希（HASH）索引，其速度比使用B-+Tree型要快**，如果读者希望使用B树型，则在创建的时候可以引用。

memory存储引擎文件数据都存储在**内存**中，如果mysqld进程发生异常，重启或关闭机器这些数据都会消失。所以memory存储引擎中的表的**生命周期很短**，一般只使用一次。

**4．ARCHIVE存储引擎**

该存储引擎非常适合存储大量独立的、作为历史记录的数据。区别于InnoDB和MyISAM这两种引擎，ARCHIVE提供了**压缩功能**，拥有高效的插入速度，但是这种引擎**不支持索引，所以查询性能较差**一些。

**四．四种存储引擎比较**

InnoDB：支持**事务处理**，支持外键，支持崩溃修复能力和并发控制。如果需要对事务的完整性要求比较高（比如银行），要求实现并发控制（比如售票），那选择InnoDB有很大的优势。如果需要**频繁的更新、删除操**作的数据库，也可以选择InnoDB，因为支持事务的提交（commit）和回滚（rollback）。

MyISAM：插入数据快，空间和内存使用比较低。如果表主要是用于插入新记录和读出记录，那么选择MyISAM能实现处理高效率。如果应用的完整性、并发性要求比 较低，也可以使用。如果数据表主要用来**插入和查询**记录，则MyISAM引擎能提供较高的处理效率

MEMORY：所有的数据都在内存中，数据的处理速度快，但是**安全性不高**。如果需要很快的读写速度，对数据的安全性要求较低，可以选择MEMOEY。它对表的大小有要求，不能建立太大的表。所以，这类数据库只使用在相对较小的数据库表。如果只是临时存放数据，数据量不大，并且不需要较高的数据安全性，可以选择将数据保存在内存中的Memory引擎，MySQL中使用该引擎作为临时表，存放查询的中间结果

如果只有INSERT和SELECT操作，可以选择Archive，Archive支持高并发的插入操作，但是**本身不是事务安全**的。Archive非常适合存储归档数据，如记录日志信息可以使用Archiv

注意，**同一个数据库也可以使用多种存储引擎的表**。如果一个表要求比较高的事务处理，可以选择InnoDB。这个数据库中可以将查询要求比较高的表选择MyISAM存储。如果该数据库需要一个用于查询的临时表，可以选择MEMORY存储引擎。